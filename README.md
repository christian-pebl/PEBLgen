# PEBLGen - Environmental Data Management Platform

A comprehensive web application for managing environmental monitoring data, including mapping, timesheets, budgets, and data visualization for CROP, WQ, CHEM, and eDNA sampling projects.

---

> **âš¡ New to this project?** See **[SETUP.md](SETUP.md)** for a super quick 3-step setup guide!

---

## ğŸš€ Quick Setup (New Machine)

### Prerequisites
- **Node.js** (v16 or higher) - [Download here](https://nodejs.org/)
- **Git** (for cloning the repository)

### Step 1: Clone the Repository
```bash
git clone <your-repo-url>
cd PEBLGen
```

### Step 2: Install Dependencies
```bash
npm install
```

### Step 3: Configure Supabase Connection
**CRITICAL:** The `supabase-client.js` file contains your database credentials.

**Good news:** This file is already in the repository with your credentials configured!

When you clone the repo, the credentials will automatically be included, so you don't need to copy any files manually.

âš ï¸ **IMPORTANT:** The `supabase-client.js` file is committed to Git and contains your Supabase credentials (lines 6-7). If you make this repo public, your database would be exposed. Keep the repository private.

### Step 4: Start the Application
```bash
npm run dev
```

The app will be available at: **http://localhost:8000**

---

## ğŸ“Š How Data Sync Works

### Automatic Cloud Synchronization
Your data is stored in **Supabase** (cloud database), which means:

âœ… **Same data on all machines** - Both laptops access the same database
âœ… **Automatic sync** - Changes on one machine appear on the other (after refresh)
âœ… **No manual backup needed** - Supabase handles backups automatically
âœ… **File storage included** - All uploaded CSV files are in cloud storage

### What's Shared Between Machines
- All database tables (pins, projects, areas, lines, transactions)
- All uploaded files (CSV files: _hapl, CROP, WQ, CHEM, etc.)
- User accounts and authentication
- Project settings and configurations

### What's NOT Shared
- The code itself (you'll install separately on each machine)
- `node_modules/` folder (regenerated by `npm install`)
- Browser cache/cookies (local to each browser)

---

## ğŸ”§ Setup Checklist

Use this checklist when setting up on a new machine:

- [ ] Node.js installed (check with `node --version`)
- [ ] Repository cloned (`git clone ...`)
- [ ] Dependencies installed (`npm install`)
- [ ] Verify `supabase-client.js` exists in project root (should be there automatically)
- [ ] Server started (`npm run dev`)
- [ ] App opens on http://localhost:8000
- [ ] Login works and you can see your existing data

---

## ğŸ—‚ï¸ Project Structure

```
PEBLGen/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ map-drawing/        # Main map application
â”‚   â”‚   â”œâ”€â”€ data-explorer/      # File management (deprecated)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ map/                # Map components (Leaflet)
â”‚   â”‚   â”œâ”€â”€ pin-data/           # Data visualization components
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ supabase/           # Database services
â”‚       â””â”€â”€ ...
â”œâ”€â”€ public/                     # Static assets
â”œâ”€â”€ .env.local                  # Supabase credentials (NOT in Git)
â”œâ”€â”€ package.json
â””â”€â”€ README.md                   # This file
```

---

## ğŸŒ Application Pages

Access these from the navigation menu:

| Page | URL | Purpose |
|------|-----|---------|
| **Map Drawing** | `/map-drawing` | Main application - create pins, areas, lines, projects |
| **Timesheet** | `/timesheet` | Track labor hours and project time |
| **Spend** | `/spend` | Budget tracking, invoices, transactions |
| **Grants** | `/grants` | Grant management and project budgets |
| **Data Explorer** | `/data-explorer` | âš ï¸ Deprecated - use Map Drawing instead |

---

## ğŸ“ Supported File Types

The application handles various environmental data formats:

- **eDNA Files** (`_hapl.csv`) - Haplotype data with rarefaction curves
- **CROP Files** (`CROP*.csv`) - Crop sampling data (DD/MM/YYYY format)
- **Water Quality** (`WQ*.csv`) - Water quality measurements
- **Chemistry** (`CHEM*.csv`) - Chemical analysis data
- **General CSV** - Any CSV file with date/time columns

---

## ğŸ” Supabase Configuration

Your Supabase credentials are stored in `supabase-client.js` (lines 6-7):

```javascript
const SUPABASE_URL = 'https://gamsynrzeixorftnivps.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJI...'; // Your key
```

**This file is already configured and committed to Git**, so it will be available when you clone the repo.

**Security Note:** Keep your GitHub repository **private** since these credentials are in the code. If you ever need to regenerate keys:

1. Go to [Supabase Dashboard](https://supabase.com/dashboard)
2. Select your project
3. Go to Settings â†’ API
4. Update the values in `supabase-client.js`

---

## ğŸ› ï¸ Development Commands

```bash
# Install dependencies
npm install

# Start development server (localhost:8000)
npm run dev

# Build for production
npm run build

# Run production build
npm start

# Type checking
npm run type-check

# Linting
npm run lint
```

---

## ğŸ› Troubleshooting

### "Can't connect to database"
- âœ… Check `supabase-client.js` exists in project root
- âœ… Verify Supabase credentials are correct in `supabase-client.js`
- âœ… Check browser console for Supabase initialization errors
- âœ… Check internet connection (Supabase is cloud-based)

### "Data not showing up"
- âœ… Verify `supabase-client.js` has the correct credentials
- âœ… Check you're logged in with the same account
- âœ… Open browser console (F12) and look for "âœ… [SUPABASE] User authenticated"
- âœ… Refresh the page (Ctrl+R or Cmd+R)

### "Port 8000 already in use"
- âœ… Stop other instances of the app
- âœ… Check if Python server is running (`python -m http.server 8000`)
- âœ… Kill the process using port 8000

### "Module not found" errors
- âœ… Run `npm install` again
- âœ… Delete `node_modules/` and `.next/` folders, then run `npm install`

---

## ğŸ“š Additional Documentation

Project-specific guides:

- **CLAUDE.md** - Task tracker and development guidelines
- **START_HERE.md** - How to start the app with shortcuts
- **HYBRID_BACKUP_SETUP.md** - Supabase backup system details
- **EMAIL_SEARCH_FEATURE.md** - Gmail integration documentation

---

## ğŸ”„ Keeping Machines in Sync

### Syncing Code Changes

**On Machine A (after making changes):**
```bash
git add .
git commit -m "Description of changes"
git push
```

**On Machine B (to get changes):**
```bash
git pull
npm install  # Only if package.json changed
```

### Syncing Data
**No action needed!** Data syncs automatically through Supabase.

---

## âš™ï¸ Configuration

### Default Port
The app runs on **port 8000** by default. To change this, modify `package.json`:
```json
"scripts": {
  "dev": "next dev -p 8000"  // Change 8000 to your preferred port
}
```

âš ï¸ **Warning:** Changing the port will create a new browser storage context, so you may need to log in again.

---

## ğŸ“ Support

**Issues with setup?**
1. Check this README's troubleshooting section
2. Review the console logs (F12 in browser) - look for Supabase messages
3. Check Supabase dashboard for connectivity
4. Verify `supabase-client.js` has correct credentials

**Feature documentation:**
- See `CLAUDE.md` for task-specific instructions
- Check individual `.md` files in the project root

---

## ğŸ”’ Security Notes

**IMPORTANT:** Your Supabase credentials are currently stored in `supabase-client.js` (which IS committed to Git).

**Keep your repository PRIVATE** to protect your database credentials.

**Files automatically excluded from Git (.gitignore):**
- `node_modules/` (large dependency folder)
- `.next/` (build output)
- `*.pdf` (invoice files)
- `.env.local` (if you add environment variables later)

---

## ğŸ“ License

All rights reserved.

---

## âœ… Quick Validation

After setup, verify everything works:

1. **Open http://localhost:8000** - App loads without errors
2. **Login** - Authentication works
3. **Check Map** - Your existing pins/areas/projects appear
4. **Upload a test CSV** - File upload and storage works
5. **Create a new pin** - Database writes work
6. **Refresh page** - Data persists (not lost)

If all checks pass âœ… - you're good to go!
